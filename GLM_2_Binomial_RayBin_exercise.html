<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BI5009</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="setup.html">
    <span class="fa fa-cog"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-desktop"></span>
     
    Learn
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="howto.html">
        <span class="fa fa-tv"></span>
         
        How-to
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    R Book
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://intro2r.com">
        <span class="fa fa-firefox"></span>
         
        Web book
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/Rbook/raw/master/docs/Rbook.pdf">
        <span class="fa fa-file-pdf"></span>
         
        PDF book
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="exercises.html">
    <span class="fa fa-book"></span>
     
    Exercises
  </a>
</li>
<li>
  <a href="exercise_solutions.html">
    <span class="fa fa-book"></span>
     
    Exercise Solutions
  </a>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-download"></span>
     
    Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Info
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">
        <span class="fa fa-book"></span>
         
        Resources
      </a>
    </li>
    <li>
      <a href="https://github.com/alexd106/BI5009">
        <span class="fa fa-github fa-lg"></span>
         
        Source code
      </a>
    </li>
    <li>
      <a href="https://twitter.com/Scedacity">
        <span class="fa fa-twitter fa-lg"></span>
         
        Twitter
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Exercise</h1>

</div>


<p> </p>
<div
id="exercise-binomial-bernoulli-glm---maturity-length-relationship-in-rays"
class="section level1">
<h1>Exercise: Binomial (Bernoulli) GLM - Maturity-length relationship in
rays</h1>
<p> </p>
<p>1. The data for this exercise consist in records of Undulate Ray
(<em>Raja undulata</em>) along the French Altlantic coast and the
English Channel. The question of interest here is to estimate the size
at which individuals become sexually mature. This is important in order
to predict the dynamics of the population and possibly for setting
fishing quotas. It has also been shown in other species that overfished
stocks tend to mature earlier in response to the selection imposed by
fishing mortality.</p>
<ul>
<li>Variables:
<ul>
<li><code>Lg</code> length (cm). Individuals less than 74 cm were
excluded from the data</li>
<li><code>Sex</code>: “F” or “M”.</li>
<li><code>Area</code>: “ATL” or “ECH” for Atlantic and English Channel,
respectively.</li>
<li><code>Month</code>: numeric</li>
<li><code>Year</code>: numeric</li>
<li><code>Mature</code>: “0” for immature and “1” for mature.</li>
</ul></li>
</ul>
<p>We will construct a model of the probability of being mature, to
address the following questions:</p>
<ul>
<li>Primary research question:
<ul>
<li>How does the probability of being mature change with body
length?</li>
</ul></li>
<li>Secondary research questions:
<ul>
<li>Does this maturity-length relationship differ between areas
(possibly as a result of different fishing pressures)?</li>
<li>Does this maturity-length relationship differ between sexes?</li>
</ul></li>
</ul>
<p> </p>
<p>2. Import the data file ‘RayMaturity.csv’ into R. As in previous
exercises, either create a new R script (perhaps call it GLM_RayBin) or
continue with your previous R script in your RStudio Project.</p>
<p> </p>
<p> </p>
<p>3. Let’s first take a look at the structure of this dataframe, and do
an initial data exploration. 0/1 data (Bernoulli) are more difficult
than most to explore. We will start by looking for any correlation/data
imbalance (different sample sizes between portions of a predictor
variable) for the all predictors (for example <code>Lg</code>,
<code>Sex</code>, and <code>Area</code>)</p>
<ul>
<li>Notes:
<ul>
<li>One approach for data imbalance is to count the number of
observations per categories of the predictors of interest.</li>
<li><code>table()</code> is a useful way to count the number of
observations per category or combinations of categories,
e.g. <code>Obs.Per.F1.F2&lt;- table(Factor1, Factor2)</code> stores the
number of observations per category of <code>Factor1</code> and
<code>Factor2</code> in a table</li>
<li><code>plot(Obs.Per.F1.F2)</code> returns a “mosaic plot” where the
area of each rectangle is proportional to the count.</li>
</ul></li>
</ul>
<p>Below is an example with <code>Year</code> and <code>Month</code>
(see the code). Use the same approach for other variables. For example,
is there is an even representation of sexes in the two areas?</p>
<p> </p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count the number of observations per month, and per year:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>Month)</span></code></pre></div>
<pre><code>## 
##   4   5   6   7   8   9 
## 253 294 300  98 114  89</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># majority of the data are from April-May-June</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>Year)</span></code></pre></div>
<pre><code>## 
## 2012 2013 2014 
##   60  537  551</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count observations per year/month combination and represent as mosaicplot</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Obs.Per.Year.Month<span class="ot">&lt;-</span> <span class="fu">table</span>(dat<span class="sc">$</span>Year, dat<span class="sc">$</span>Month)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># See what&#39;s in the table:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Obs.Per.Year.Month</span></code></pre></div>
<pre><code>##       
##          4   5   6   7   8   9
##   2012   0  29   8  20   0   3
##   2013 105  75 182  40 114  21
##   2014 148 190 110  38   0  65</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Year in rows, Months in columns</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mosaic plot (this is the default plot for a contingency table in R)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Obs.Per.Year.Month)</span></code></pre></div>
<p><img src="GLM_2_Binomial_RayBin_exercise_files/figure-html/Q3a-1.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fewer observations in 2012 (column is narrow)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variable sample size from each month from April to Sept (height / area of the squares varies)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># but overall a fairly &quot;random&quot; representation of all months across years,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># so should not be problematic</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (for example, an issue might arise if all observations from Spring</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># came from one year and all Summer observations from a different</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># year, hence not comparable maybe)</span></span></code></pre></div>
<p>Next we look for factors affecting the probability of maturity. Which
ones are continuous or categorical?</p>
<ul>
<li>Notes:
<ul>
<li>The data are not probabilities of maturity, they are just 0 and 1’s.
We can’t visualise probabilities of maturity unless we average the data
for groups of observations</li>
<li>For exploring the effect of discrete predictors on the probability
of maturity (response), you may calculate mean maturity per category,
which is the proportion of mature individuals:
<code>bla&lt;- tapply(dat$Mature, list(dat$FactorOfInterest), mean)</code>
and plot this using
<code>barplot(bla, type= "b", ylim= c(0, 1), xlab= "FactorOfInterest", ylab= "maturity")</code></li>
<li>For the effect of continuous predictors on the response, the best
approach is to treat the continuous variable as discrete (using
<code>as.factor</code> for example), for the data exploration.</li>
</ul></li>
</ul>
<p>Below is an example with Sex. Repeat with other relevant
predictors.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maturity in relation to Sex</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mean.per.Sex<span class="ot">&lt;-</span> <span class="fu">tapply</span>(dat<span class="sc">$</span>Mature, <span class="fu">list</span>(dat<span class="sc">$</span>Sex), mean)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(mean.per.Sex, <span class="at">ylim=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span> <span class="st">&quot;Sex&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;proportion mature&quot;</span>)</span></code></pre></div>
<p><img src="GLM_2_Binomial_RayBin_exercise_files/figure-html/Q3c-1.png" width="672" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability maybe higher in males?</span></span></code></pre></div>
<p> </p>
<p>4. Time to fit a model to address some of the research questions. For
simplicity, we will ignore Sex and Month for now, but if you wish, you
can investigate them in your own time later. Because most of the data
are males, first create a subset of the data with only the males data.
For this new data set, specify a Binomial GLM looking at the effects of
length and area, and whether the effect of length varies between areas
(using <code>glm()</code> and the appropriate <code>family</code>
argument). Hint: do you need to include an interaction term?</p>
<p> </p>
<p> </p>
<p>5. Obtain summaries of the model output using the
<code>summary()</code> function.</p>
<ul>
<li>How do you interpret each term?
<ul>
<li>what is the <code>Intercept</code>, and which categories does it
refer to?</li>
<li>what is the <code>Lg</code> effect, and which category does it refer
to?</li>
<li>what is the <code>AreaECH</code> effect?</li>
<li>what is the <code>Lg:AreaECH</code> effect, and which category does
it refer to?</li>
</ul></li>
</ul>
<p> </p>
<p> </p>
<p>6. Do you need to simplify the model? Use <code>drop1</code> to find
out, with the appropriate test distribution (Chi-squared).</p>
<p> </p>
<p> </p>
<p>7. Let’s now produce plots to validate the model, using Pearson
residuals and the usual model validation tools. Are they helpful?</p>
<p> </p>
<p>8. These plots are not very useful, because the data are 0/1 and thus
the individual residuals (difference between the 0/1 observations and
continuous fitted values) follow weird patterns. But we can actually get
a bit further by taking the mean of groups of residuals (groups being
the levels of a predictor). The idea is that if there is no trend in the
residuals, these means should be randomly distributed around zero (and
ideally, close to zero as well). The <code>binnedplot()</code> function
in the <code>arm</code> package does exactly that. for numerical
variables, <code>binnedplot()</code> splits the variable into discrete
bins, and calculates the mean of the residuals for each bin.
<code>binnedplot()</code> requires numerical variables:
<code>binnedplot(x= MyContinuousPredictor, y= MyResiduals, xlab= "MyContinuousPredictor", nclass= NumberOfBinsWanted)</code>.
If needed you can convert categorical predictors into numerical:
<code>binnedplot(x= as.numeric(MyFactor), y= MyResiduals, xlab= "MyFactor")</code>.</p>
<p>Here is an example using <code>binnedplot</code> with
<code>Month</code> (even if it is not in the model, but to see if it
should). You can try yourself with area, and body length.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">x=</span> datM<span class="sc">$</span>Month, <span class="at">y=</span> res2.p, <span class="at">xlab=</span> <span class="st">&quot;Month&quot;</span>, <span class="at">nclass =</span> <span class="dv">6</span>)</span></code></pre></div>
<p><img src="GLM_2_Binomial_RayBin_exercise_files/figure-html/Q8a-1.png" width="480" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nclass= 6 because we have 6 months in the data</span></span></code></pre></div>
<blockquote>
<p>We want residuals to be close to zero, but how far is too far?
<code>binnedplot</code> conveniently adds expected limits (grey lines),
beyond which the the fit of the model is questionable. Here the
residuals per month are close to the limit, and even outside for August:
including <code>Month</code> would probably improve the model a bit.</p>
</blockquote>
<p> </p>
<p>9. Are you happy with the diagnostic plots?</p>
<p> </p>
<p> </p>
<p>10. Assuming that the model is fine as it is, let’s plot the
predictions of the model in relation to length <code>Lg</code> for the
Channel and the Atlantic coast. For the sake of understanding how the
models works, let’s start with predictions on the link scale
<code>type= "link"</code>. What do these numbers represent?</p>
<p> </p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a sequence of increasing lengths</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Seq.Length<span class="ot">&lt;-</span> <span class="dv">74</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PREDICTIONS FOR MALES ON THE ATLANTIC COAST</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>dat.new.ATL<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Sex=</span> <span class="st">&quot;M&quot;</span>, <span class="at">Lg=</span> Seq.Length, <span class="at">Area=</span> <span class="st">&quot;ATL&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>Mat1.pred.ATL<span class="ot">&lt;-</span> <span class="fu">predict</span>(Mat1, dat.new.ATL, <span class="at">type=</span> <span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span> T)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add them to the prediction data frame, to keep the workspace tidy</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>dat.new.ATL<span class="sc">$</span>fit<span class="ot">&lt;-</span> Mat1.pred.ATL<span class="sc">$</span>fit</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Same approach for MALES IN THE ENGLISH CHANNEL</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>dat.new.ECH<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Sex=</span> <span class="st">&quot;M&quot;</span>, <span class="at">Lg=</span> Seq.Length, <span class="at">Area=</span> <span class="st">&quot;ECH&quot;</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>Mat1.pred.ECH<span class="ot">&lt;-</span> <span class="fu">predict</span>(Mat1, dat.new.ECH, <span class="at">type=</span> <span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span> T)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>dat.new.ECH<span class="sc">$</span>fit<span class="ot">&lt;-</span> Mat1.pred.ECH<span class="sc">$</span>fit</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># PLOTTING THE TWO AREAS TOGETHER</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot predictions for Atlantic coast</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span> Seq.Length, <span class="at">y=</span> dat.new.ATL<span class="sc">$</span>fit, </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">type=</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span> <span class="dv">2</span>, <span class="at">xlab=</span> <span class="st">&quot;Length (cm)&quot;</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab=</span> <span class="st">&quot;Fitted value (link scale)&quot;</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">main=</span> <span class="st">&quot;Predictions for Males&quot;</span>, <span class="at">col=</span> <span class="st">&quot;navy&quot;</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predictions for English Channel</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x=</span> Seq.Length, <span class="at">y=</span> dat.new.ECH<span class="sc">$</span>fit, <span class="at">lwd=</span> <span class="dv">2</span>, <span class="at">col=</span> <span class="st">&quot;cyan&quot;</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span> <span class="dv">87</span>, <span class="at">y=</span> <span class="fl">0.3</span>, <span class="at">legend=</span> <span class="fu">c</span>(<span class="st">&quot;Atlantic coast&quot;</span>, <span class="st">&quot;English Channel&quot;</span>), </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd=</span> <span class="dv">2</span>, <span class="at">col=</span> <span class="fu">c</span>(<span class="st">&quot;navy&quot;</span>, <span class="st">&quot;cyan&quot;</span>), <span class="at">bty=</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="GLM_2_Binomial_RayBin_exercise_files/figure-html/Q10a-1.png" width="672" /></p>
<blockquote>
<p>The predictions on the link scale are linear, as they should be. But
they represent the log-odds of being mature: # For a body length of 75
cm for example, a ray in the English Channel has log-odds of being
mature of about -1.6: not exactly the most intuitive thing to
interpret!</p>
</blockquote>
<p>The default link function for the binomial GLM is the logit function,
<code>log(p/(1-p))</code>. And the fitted values can be transformed
using <code>exp(fitted.value) / (1 + exp(fitted.value))</code>. You can
use this formula to back-transform your predictions, but this is a bit
cumbersome to write. R provides the function <code>plogis</code> which
does the same calculation. Use <code>plogis</code> or the
back-transformation formula to compute the predicted values on the
probability (response) scale, and plot them against length, for each
area.</p>
<p> </p>
<p>11. <strong>Optionally</strong>, you may add the confidence intervals
around the predictions (this would be highly recommended in a
report).</p>
<ul>
<li>Calculation of confidence intervals:
<ul>
<li>As for the Poisson GLM, you will need to calculate the lower and
upper bounds of the 95% CI on the link scale (same method)</li>
<li>Only then, convert these confidence limits to the response scale,
using <code>plogis</code> (different from the Poisson GLM, since the
link function is different)</li>
</ul></li>
</ul>
<p> </p>
<p> </p>
<p>12. How satisfied are you with the model, and with all the
assumptions being met? What have you learned from it, with respect to
the initial aims of the study?</p>
<p> </p>
<p> </p>
<p>End of the Binomial (Bernoulli) GLM exercise - Maturity-length
relationship in rays</p>
<p> </p>
<p><strong>Note:</strong> If you cannot install the <code>arm</code>
package and access its <code>binnedplot</code> function, you can use
this “DIY” alternative instead, in the code chunk below. The green line
shows the mean of the residuals for each value or bin of the X
variable.</p>
<p> </p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the residuals against length</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res2.p <span class="sc">~</span> datM<span class="sc">$</span>Lg, <span class="at">col=</span> datM<span class="sc">$</span>Mature <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get the mean of the residuals for each 1 cm of length</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>lg.means<span class="ot">&lt;-</span> <span class="fu">tapply</span>(res2.p, <span class="fu">list</span>(datM<span class="sc">$</span>Lg), mean)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert ordered bin labels into numbers (1 to 365)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>lg.vals<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(lg.means))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(lg.means <span class="sc">~</span> lg.vals, <span class="at">col=</span> <span class="dv">3</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span> <span class="dv">0</span>, <span class="at">lty=</span> <span class="dv">3</span>, <span class="at">col=</span> <span class="fu">grey</span>(<span class="fl">0.5</span>))</span></code></pre></div>
<p> </p>
<p><strong>Optional</strong>. If you are curious about the Sex effect,
you can add it in the model. Note that as well as differences between
areas, there may be an interaction between length and sex (Males and
Females reach maturity at different rates). Simplify the model if
necessary, validate, and plot the predictions for all areas and sexes.
Remember to use the original, full data set with the females in!</p>
<p> </p>
<p>What can we infer from this, with respect to the initial aims of the
study?</p>
<p> </p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
